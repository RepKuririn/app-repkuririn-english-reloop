# Phase 7: Quality Assurance Testing Guide

## テスト環境準備

### 1. ビルドと拡張機能の読み込み
```bash
npm run build
```

1. `chrome://extensions/` を開く
2. 「デベロッパーモード」を有効化
3. 「パッケージ化されていない拡張機能を読み込む」→ `dist` フォルダを選択
4. エラーがないことを確認

---

## テストカテゴリ

### A. Content Script Tests (字幕パネル機能)

#### A-1. パネル表示
- [ ] YouTubeビデオページでパネルが右側に表示される
- [ ] 非ビデオページ(ホーム、検索)ではパネルが表示されない
- [ ] SPA遷移（別の動画へ移動）時にパネルが更新される

#### A-2. 字幕抽出と表示
- [ ] YouTubeの字幕パネルが開いていない状態で「🔄」クリック
  - **期待**: 指示メッセージが表示される（「字幕パネルを開いてください」）
- [ ] 字幕パネルを開いて「🔄」クリック
  - **期待**: 字幕セグメントのリストが表示される
- [ ] 字幕のないビデオで字幕抽出を試行
  - **期待**: 「No subtitles found」メッセージ

#### A-3. 字幕クリック → ビデオシーク
- [ ] 字幕セグメントをクリック
  - **期待**: ビデオが該当タイムスタンプにシーク
- [ ] 再生中に現在のセグメントがハイライトされる
- [ ] 自動ハイライト機能が再生に追従する

#### A-4. A-Bループ機能
- [ ] セグメントの🔁をクリック
  - **期待**: 「開始点選択」状態になる（視覚的表示）
- [ ] 別のセグメントの🔁をクリック
  - **期待**: ループ範囲が設定され、自動ループ再生開始
- [ ] 同じセグメントの🔁を2回クリック
  - **期待**: 単一セグメントのループが設定される
- [ ] ループ再生中にループ終了点に到達
  - **期待**: 自動的に開始点にシーク
- [ ] 「クリア」ボタンをクリック
  - **期待**: ループが解除される

#### A-5. フレーズ保存機能
- [ ] セグメントの💾をクリック
  - **期待**: 保存ダイアログが表示される
- [ ] 保存ダイアログでメモを追加して「保存」
  - **期待**: トースト通知が表示される（「保存しました」）
- [ ] 保存ボタンのアニメーションフィードバックを確認

---

### B. Popup Tests (拡張機能ポップアップ)

- [ ] ポップアップを開く
  - **期待**: 保存フレーズ数が表示される
  - **期待**: グループ数が表示される
- [ ] 「ライブラリを開く」ボタンをクリック
  - **期待**: オプションページが開く

---

### C. Options Page Tests (ライブラリページ)

#### C-1. フレーズ表示
- [ ] オプションページを開く
  - **期待**: 保存したフレーズがカード形式で表示される
- [ ] フレーズカードをクリック
  - **期待**: 詳細モーダルが表示される

#### C-2. グループ管理
- [ ] 「グループを作成」ボタンをクリック
  - **期待**: グループ作成ダイアログが表示される
- [ ] グループ名、色、説明を入力して保存
  - **期待**: 新しいグループが追加される
- [ ] グループ編集ボタンをクリック
  - **期待**: グループ編集ダイアログが表示される
- [ ] グループ削除ボタンをクリック
  - **期待**: 確認ダイアログが表示される
  - **期待**: 削除後、フレーズは未分類になる

#### C-3. フィルタリング
- [ ] グループフィルタを選択
  - **期待**: 該当グループのフレーズのみ表示される
- [ ] 「すべて」フィルタに戻す
  - **期待**: 全フレーズが表示される

#### C-4. フレーズ詳細と再生
- [ ] フレーズ詳細モーダルで「再生」ボタンをクリック
  - **期待**: YouTube動画が該当タイムスタンプで開く
- [ ] フレーズにグループを割り当て
  - **期待**: グループバッジが表示される
- [ ] フレーズを削除
  - **期待**: 確認ダイアログが表示され、削除される

#### C-5. 一括操作
- [ ] 複数のフレーズを選択（チェックボックス）
  - **期待**: 選択数が表示される
- [ ] 「一括削除」ボタンをクリック
  - **期待**: 確認ダイアログが表示される
  - **期待**: 削除後、選択がクリアされる

---

### D. Edge Case Tests (エッジケース)

#### D-1. 長時間動画
- [ ] 1時間以上の動画でテスト
  - **期待**: タイムスタンプが「1:02:30」形式で正しく表示される
  - **期待**: 字幕抽出とループが正常動作

#### D-2. 字幕なしビデオ
- [ ] 字幕が利用できない動画でテスト
  - **期待**: 「No subtitles found」メッセージが表示される
  - **期待**: エラーが発生しない

#### D-3. 複数言語字幕
- [ ] 英語、日本語など複数の字幕が利用可能な動画
  - **期待**: 選択中の字幕言語で抽出される

#### D-4. ダークモード
- [ ] OSをダークモードに設定
  - **期待**: パネルとオプションページがダークモードで表示される
- [ ] ライトモードに戻す
  - **期待**: 正常にライトモードで表示される

#### D-5. 拡張機能リロード
- [ ] `chrome://extensions/` でリロードボタンをクリック
  - **期待**: データが保持される（IndexedDBはクリアされない）
  - **期待**: 再度動画ページでパネルが表示される

#### D-6. IndexedDB利用不可（エラーハンドリング）
- **テスト方法**: DevToolsで `indexedDB` をモックして無効化
  ```javascript
  // DevTools Console
  Object.defineProperty(window, 'indexedDB', { value: null });
  ```
- [ ] 拡張機能を読み込む
  - **期待**: コンソールに「Database unavailable」エラーログ
- [ ] 保存を試みる
  - **期待**: エラートーストが表示される

#### D-7. Video要素の遅延読み込み
- **テスト方法**: 低速ネットワークをシミュレート
- [ ] ビデオページを開く
  - **期待**: リトライログが表示される
  - **期待**: 最大3回リトライ後に動作する

---

## エラーハンドリング検証 (PART 9準拠)

### E-1. Transcript関連エラー
- [x] トランスクリプトパネル未開封時の指示メッセージ ✅
- [x] セグメント未検出時のメッセージ ✅
- [x] セレクタミスマッチ時の警告ログ ✅

### E-2. Player関連エラー
- [x] Video要素未検出時のリトライ（3回、500ms間隔） ✅
- [x] シーク失敗時の内部ログ ✅

### E-3. Storage関連エラー
- [x] IndexedDB利用不可時のエラーメッセージ ✅
- [x] 保存失敗時のトースト表示 ✅

### E-4. ログフォーマット
- [x] すべてのログに `[Subtitle Loop]` プレフィックス ✅
- [x] デバッグログの削除 ✅

---

## パフォーマンステスト

### F-1. 大量フレーズ
- [ ] 100件以上のフレーズを保存
  - **期待**: オプションページの読み込みが3秒以内
- [ ] フィルタリングの応答速度を確認
  - **期待**: 1秒以内に結果が表示される

### F-2. 長時間動画
- [ ] 2時間以上の動画でセグメント抽出
  - **期待**: 5秒以内に完了
- [ ] 1000セグメント以上のリスト表示
  - **期待**: スクロールが滑らか

---

## テスト結果記録

### 実施日: YYYY-MM-DD

| カテゴリ | テスト項目 | 結果 | 備考 |
|---------|----------|------|------|
| A-1     | パネル表示 | ⬜ | |
| A-2     | 字幕抽出 | ⬜ | |
| A-3     | ビデオシーク | ⬜ | |
| A-4     | A-Bループ | ⬜ | |
| A-5     | フレーズ保存 | ⬜ | |
| B       | Popup | ⬜ | |
| C-1     | フレーズ表示 | ⬜ | |
| C-2     | グループ管理 | ⬜ | |
| C-3     | フィルタリング | ⬜ | |
| C-4     | フレーズ詳細 | ⬜ | |
| C-5     | 一括操作 | ⬜ | |
| D-1     | 長時間動画 | ⬜ | |
| D-2     | 字幕なし | ⬜ | |
| D-3     | 複数言語 | ⬜ | |
| D-4     | ダークモード | ⬜ | |
| D-5     | 拡張リロード | ⬜ | |
| D-6     | IndexedDB無効 | ⬜ | |
| D-7     | Video遅延 | ⬜ | |
| E       | エラーハンドリング | ✅ | コードレビュー完了 |
| F-1     | 大量フレーズ | ⬜ | |
| F-2     | 長時間動画 | ⬜ | |

### 凡例
- ✅ = 合格
- ❌ = 不合格
- ⬜ = 未実施
- ⚠️ = 要注意

---

## 次のステップ

1. このガイドに従って手動テストを実施
2. 問題が見つかった場合は issue を記録
3. すべてのテストが合格したら Phase 7 完了
4. CLAUDE.md を更新
